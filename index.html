<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AURA ECOSYSTEM</title>
<style>
  body {
    margin:0;
    overflow:hidden;
    background:#000;
    color:#0ff;
    font-family: 'Courier New', monospace;
  }

  #quantum-output { position:absolute; top:0; left:0; width:100%; height:100%; z-index:12; }
  .quantum-line { position:absolute; font-weight:bold; text-shadow:0 0 5px #0ff,0 0 10px #0ff; }
  .floating-node {
    position:absolute;
    border-radius:50%;
    background-color: rgba(125,74,255,0.6);
    box-shadow:0 0 10px rgba(125,74,255,0.6);
    transition: box-shadow 0.1s ease-in-out;
  }
  #ambient-glow { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:10; }

  #data-panels {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index:20;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .panel {
    background: rgba(0,0,0,0.6);
    color: #0ff;
    padding: 10px 15px;
    font-weight:bold;
    border-radius:8px;
    text-shadow:0 0 5px #0ff;
    transition: transform 0.1s ease, background 0.3s ease;
  }

  .panel-chart { display:block; margin-top:5px; }
</style>
</head>
<body>

<div id="quantum-output"></div>
<div id="ambient-glow"></div>

<div id="data-panels">
  <div class="panel" id="quantum-panel">
    Quantum Activity: 0
    <canvas class="panel-chart" width="120" height="40"></canvas>
  </div>
  <div class="panel" id="spark-panel">
    Active Sparks: 0
    <canvas class="panel-chart" width="120" height="40"></canvas>
  </div>
  <div class="panel" id="node-panel">
    Active Nodes: 0
    <canvas class="panel-chart" width="120" height="40"></canvas>
  </div>
</div>

<script>
// ======= Setup =======

const variables = ['ψ','Φ','Δ','λ','θ','σ','E','ħ'];
const operators = ['=','≈','∑','+','-','*','/'];
const numLines = 50;
const lines = [];
const nodes = [];
const sparks = [];
const maxNodes = 10;
let mouse = {x: window.innerWidth/2, y: window.innerHeight/2};

// Track mouse
window.addEventListener('mousemove', e => { mouse.x=e.clientX; mouse.y=e.clientY; });

// Quantum output
const quantumOutput = document.getElementById('quantum-output');

// Helpers
function getRandomQuantumLine() {
  const var1 = variables[Math.floor(Math.random()*variables.length)];
  const var2 = variables[Math.floor(Math.random()*variables.length)];
  const op = operators[Math.floor(Math.random()*operators.length)];
  const value = (Math.random()*10).toFixed(3);
  return `${var1} ${op} ${var2} + ${value}`;
}

function createQuantumLine() {
  const line = document.createElement('div');
  line.className='quantum-line';
  line.textContent=getRandomQuantumLine();
  line.x=Math.random()*window.innerWidth;
  line.y=Math.random()*window.innerHeight;
  line.speed=1+Math.random()*2;
  line.colorHue=Math.random()*360;
  line.style.left=line.x+'px';
  line.style.top=line.y+'px';
  quantumOutput.appendChild(line);
  lines.push(line);
}
for(let i=0;i<numLines;i++) createQuantumLine();

function createNode(x,y){
  const el = document.createElement('div');
  el.className='floating-node';
  el.style.width='20px';
  el.style.height='20px';
  el.style.left=x+'px';
  el.style.top=y+'px';
  document.body.appendChild(el);
  nodes.push({x,y,el});
}
for(let i=0;i<maxNodes;i++){
  createNode(Math.random()*window.innerWidth, Math.random()*window.innerHeight);
}

// ======= Canvases =======

const sparkCanvas = document.createElement('canvas');
sparkCanvas.style.position='absolute';
sparkCanvas.style.top='0';
sparkCanvas.style.left='0';
sparkCanvas.style.width='100%';
sparkCanvas.style.height='100%';
sparkCanvas.style.pointerEvents='none';
sparkCanvas.style.zIndex=14;
document.body.appendChild(sparkCanvas);
const sparkCtx = sparkCanvas.getContext('2d');
sparkCanvas.width=window.innerWidth;
sparkCanvas.height=window.innerHeight;

const glowCanvas = document.createElement('canvas');
glowCanvas.style.position='absolute';
glowCanvas.style.top='0';
glowCanvas.style.left='0';
glowCanvas.style.width='100%';
glowCanvas.style.height='100%';
glowCanvas.style.pointerEvents='none';
glowCanvas.style.zIndex=13;
document.body.appendChild(glowCanvas);
const glowCtx = glowCanvas.getContext('2d');
glowCanvas.width=window.innerWidth;
glowCanvas.height=window.innerHeight;

const ambientCanvas = document.getElementById('ambient-glow');
const ambientCtx = ambientCanvas.getContext('2d');
ambientCanvas.width=window.innerWidth;
ambientCanvas.height=window.innerHeight;

const quantumPanel = document.getElementById('quantum-panel');
const sparkPanel = document.getElementById('spark-panel');
const nodePanel = document.getElementById('node-panel');

const quantumCanvas = document.querySelector('#quantum-panel canvas').getContext('2d');
const sparkCanvasCtx = document.querySelector('#spark-panel canvas').getContext('2d');
const nodeCanvasCtx = document.querySelector('#node-panel canvas').getContext('2d');

const chartData={quantum:[],sparks:[],nodes:[]};
const maxPoints=50;

// ======= Spark + Trail Classes =======

class Spark{
  constructor(x,y,targetNode){
    this.x=x; this.y=y; this.target=targetNode;
    this.speed=0.02+Math.random()*0.03;
    this.hue=Math.random()*360;
  }
  update(){
    const dx=this.target.x-this.x;
    const dy=this.target.y-this.y;
    this.x+=dx*this.speed;
    this.y+=dy*this.speed;
    sparkTrails.push(new SparkTrail(this.x,this.y,this.hue));
    sparkCtx.beginPath();
    sparkCtx.arc(this.x,this.y,2,0,Math.PI*2);
    sparkCtx.fillStyle=`hsla(${this.hue},100%,70%,0.8)`;
    sparkCtx.fill();
  }
  isArrived(){ return Math.hypot(this.x-this.target.x,this.y-this.target.y)<5; }
}

class SparkTrail{
  constructor(x,y,hue){ this.x=x; this.y=y; this.hue=hue; this.life=30+Math.random()*20; }
  update(){
    this.life--;
    glowCtx.beginPath();
    glowCtx.arc(this.x,this.y,1.5,0,Math.PI*2);
    glowCtx.fillStyle=`hsla(${this.hue},100%,70%,${this.life/50})`;
    glowCtx.fill();
  }
}

class MicroFlare{
  constructor(x,y){ this.x=x; this.y=y; this.size=Math.random()*3+1; this.life=20+Math.random()*30; this.hue=Math.random()*360; }
  update(){
    this.life--;
    ambientCtx.beginPath();
    ambientCtx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ambientCtx.fillStyle=`hsla(${this.hue},100%,70%,${this.life/50})`;
    ambientCtx.fill();
  }
}

const sparksArr=[],sparkTrails=[],microFlares=[];

// ======= Animation Loop =======

function animateAll(){
  sparkCtx.clearRect(0,0,sparkCanvas.width,sparkCanvas.height);
  glowCtx.clearRect(0,0,glowCanvas.width,glowCanvas.height);
  ambientCtx.clearRect(0,0,ambientCanvas.width,ambientCanvas.height);

  // Update quantum lines
  lines.forEach(line=>{
    line.y+=line.speed;
    const dxm=mouse.x-line.x;
    const dym=mouse.y-line.y;
    if(Math.sqrt(dxm*dxm+dym*dym)<150){ line.x+=dxm*0.02; line.y+=dym*0.02; }
    nodes.forEach(node=>{
      const dx=node.x-line.x;
      const dy=node.y-line.y;
      const dist=Math.sqrt(dx*dx+dy*dy);
      if(dist<120){ line.x+=dx*0.03; line.y+=dy*0.03;
        if(Math.random()<0.02) sparksArr.push(new Spark(line.x,line.y,node));
      }
    });
    if(line.y>window.innerHeight){ line.y=-20; line.x=Math.random()*window.innerWidth; line.textContent=getRandomQuantumLine(); line.colorHue=Math.random()*360; }
    line.style.left=line.x+'px';
    line.style.top=line.y+'px';
    line.style.color=`hsla(${line.colorHue},100%,70%,${0.6+0.4*Math.sin(Date.now()*0.005)})`;
  });

  // Sparks
  for(let i=sparksArr.length-1;i>=0;i--){
    sparksArr[i].update();
    if(sparksArr[i].isArrived()){
      sparksArr[i].target.el.style.boxShadow=`0 0 ${15+Math.random()*15}px rgba(125,74,255,0.9)`;
      sparksArr.splice(i,1);
    }
  }

  // Spark trails
  for(let i=sparkTrails.length-1;i>=0;i--){
    sparkTrails[i].update();
    if(sparkTrails[i].life<=0) sparkTrails.splice(i,1);
  }

  // Ambient glow & micro-flares
  nodes.forEach(node=>{
    const radius=50+20*Math.sin(Date.now()*0.005+node.x);
    const gradient=ambientCtx.createRadialGradient(node.x,node.y,0,node.x,node.y,radius);
    gradient.addColorStop(0,'rgba(125,74,255,0.15)');
    gradient.addColorStop(1,'rgba(125,74,255,0)');
    ambientCtx.fillStyle=gradient;
    ambientCtx.beginPath();
    ambientCtx.arc(node.x,node.y,radius,0,Math.PI*2);
    ambientCtx.fill();
  });

  lines.forEach(line=>{ if(Math.random()<0.02) microFlares.push(new MicroFlare(line.x+(Math.random()-0.5)*10,line.y+(Math.random()-0.5)*10)); });
  for(let i=microFlares.length-1;i>=0;i--){ microFlares[i].update(); if(microFlares[i].life<=0) microFlares.splice(i,1); }

  // Panels update
  const activeQuantum = lines.filter(line=>nodes.some(node=>Math.hypot(node.x-line.x,node.y-line.y)<120)).length;
  chartData.quantum.push(activeQuantum);
  chartData.sparks.push(sparksArr.length);
  chartData.nodes.push(nodes.length);
  if(chartData.quantum.length>maxPoints) chartData.quantum.shift();
  if(chartData.sparks.length>maxPoints) chartData.sparks.shift();
  if(chartData.nodes.length>maxPoints) chartData.nodes.shift();

  quantumPanel.textContent=`Quantum Activity: ${activeQuantum}`;
  sparkPanel.textContent=`Active Sparks: ${sparksArr.length}`;
  nodePanel.textContent=`Active Nodes: ${nodes.length}`;

  quantumPanel.style.transform=`scale(${1 + activeQuantum/50 * 0.2})`;
  sparkPanel.style.transform=`scale(${1 + sparksArr.length/50 * 0.2})`;
  nodePanel.style.transform=`scale(${1 + nodes.length/10 * 0.1})`;

  quantumPanel.style.background=`rgba(0,0,0,${0.5 + activeQuantum/50*0.5})`;
  sparkPanel.style.background=`rgba(0,0,0,${0.5 + sparksArr.length/50*0.5})`;
  nodePanel.style.background=`rgba(0,0,0,${0.5 + nodes.length/10*0.5})`;

  // Draw charts
  function drawChart(ctx,data){ ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height); ctx.beginPath();
    data.forEach((v,i)=>{ const x=i*(ctx.canvas.width/maxPoints); const y=ctx.canvas.height-(v/50*ctx.canvas.height); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });
    ctx.strokeStyle='#0ff'; ctx.lineWidth=1.5; ctx.stroke(); }
  drawChart(quantumCanvas,chartData.quantum);
  drawChart(sparkCanvasCtx,chartData.sparks);
  drawChart(nodeCanvasCtx,chartData.nodes);

  requestAnimationFrame(animateAll);
}

animateAll();

// ======= Web Audio Ambient Hum =======
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
const oscillator=audioCtx.createOscillator();
oscillator.type='sine';
oscillator.frequency.setValueAtTime(55,audioCtx.currentTime);
const gainNode=audioCtx.createGain();
gainNode.gain.setValueAtTime(0.02,audioCtx.currentTime);
oscillator.connect(gainNode); gainNode.connect(audioCtx.destination); oscillator.start();
function modulateHum(){
  const activity=sparksArr.length; 
  const factor=Math.min(activity/50,1);
  oscillator.frequency.setValueAtTime(55+factor*20,audioCtx.currentTime);
  gainNode.gain.setValueAtTime(0.01+factor*0.04,audioCtx.currentTime);
  requestAnimationFrame(modulateHum);
}
modulateHum();
document.body.addEventListener('click',()=>{audioCtx.resume();});

// Handle resize
window.addEventListener('resize',()=>{
  sparkCanvas.width=window.innerWidth; glowCanvas.width=window.innerWidth; ambientCanvas.width=window.innerWidth;
  sparkCanvas.height=window.innerHeight; glowCanvas.height=window.innerHeight; ambientCanvas.height=window.innerHeight;
});
</script>
</body>
</html>
